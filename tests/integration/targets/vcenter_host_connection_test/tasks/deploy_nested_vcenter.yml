# tasks/deploy_nested_vcenter.yml

- name: Deploy Nested VCenter
  ansible.builtin.import_role:
    name: cloud.vmware_ops.provision_vcenter
  tags: [deploy_vc]
  vars:
    provision_vcenter_hostname: "{{ _esxi_info.results[0].instance.ipv4 }}"
    provision_vcenter_username: root
    provision_vcenter_password: "{{ esxi_root_password }}"
    provision_vcenter_validate_certs: false
    provision_vcenter_vm_name: "{{ resource_prefix }}-nested-vcsa"
    provision_vcenter_vm_network_hostname: "{{ nested_vcenter_hostname }}"
    provision_vcenter_iso_path: "{{ nested_vcenter_iso_path }}"
    provision_vcenter_vm_network_mode: dhcp
    provision_vcenter_vm_network_name: VM Network
    provision_vcenter_vm_datastore: datastore1
    provision_vcenter_vm_password: "{{ esxi_root_password }}"