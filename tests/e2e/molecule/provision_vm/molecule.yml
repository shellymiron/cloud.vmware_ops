---
dependency:
  name: galaxy
  options:
    requirements-file: ../requirements.yml

platforms:
  - name: molecule-ubuntu
    image: ubuntu:18.04
driver:
  options:
    managed: False
    login_cmd_template: "podman exec -ti {instance} bash"
    ansible_connection_options:
      ansible_connection: podman

provisioner:
  name: ansible
  lint: |
    set -e
    echo "Run yamllint"
    yamllint .
    echo "Run ansible-lint"
    ansible-lint
  env:
    ANSIBLE_ROLES_PATH: "../../../../roles"
  config_options:
    defaults:
      # vault_password_file: ${HOME}/vault.pass
      callback_whitelist: junit
  playbooks:
    converge: ../converge.yml
    # destroy: destroy.yml

scenario:
  test_sequence:
    - converge
    - idempotence
    - verify

verifier:
  name: ansible
  options:
    junit-xml: ./test-results.xml
